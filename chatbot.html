<!DOCTYPE html>
<html>
    <head>
    <title>Chatbot</title>
    </head>
    <body>
    <div class="js-container"></div>

        <script src="https://unpkg.com/supersimpledev/react.js"></script>
        <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
        <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
        <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>
        <script src="https://unpkg.com/supersimpledev/babel.js"></script>
        <script type="text/babel">
            function ChatInput({chatMessages, setChatMessages}) {
                const [inputText, setInputText] = React.useState("")
                const [isLoading, setIsLoading] = React.useState(0)


                function saveInputText(event){
                    
                    setInputText(event.target.value);
                    };
                
                function handleKeyDown(event){
                    if (event.key === "Enter"){
                        sendMessage();
                    }
                    if (event.key === "Escape"){
                        setInputText("");
                    }
                };

                async function sendMessage(event){
                    if (inputText ==="" | isLoading){
                        return;
                    }
                    const newChatMessages = [
                        ...chatMessages, {
                        messege: inputText,
                        sender: "user",
                        id: crypto.randomUUID()
                        }
                        ];

                    setChatMessages(newChatMessages);
                    setIsLoading(1);
                    setInputText("");
                    const beforeResponse =  {
                        messege: "Loading...",
                        sender: "robot",
                        id: crypto.randomUUID()
                        };
                    setChatMessages([
                        ...newChatMessages, beforeResponse]);
                    const response =  await Chatbot.getResponseAsync(inputText);
                    // setChatMessages([
                    //     ...newChatMessages, {
                    //     messege: response,
                    //     sender: "robot",
                    //     id: crypto.randomUUID()
                    //     }
                    //     ]);
                    beforeResponse.messege = response;
                    setChatMessages([
                        ...newChatMessages, beforeResponse]);
                    setIsLoading(0);
                };

                return (
                    <>
                        <input 
                            placeholder="Send a messege to chatbot" 
                            size="30" 
                            onChange={saveInputText}
                            onKeyDown={handleKeyDown}
                            value={inputText}
                        />
                        <button 
                        onClick={sendMessage}>Send</button>
                    </>
                );
        }

            function ChatMessage({ messege, sender } ){

                return (
                    <div>
                        {sender === "robot" &&  (
                            <img src="robot.png" width="50"></ img>
                        )}
                        {messege}
                        {sender === "user" &&  (
                            <img src="user.png" width="50"></ img>

                        )}
                    </div>
                )
            }


        
        function DisplayChat({chatMessages, setChatMessages}){
             
            // const [chatMessages, setChatMessages] = array

            
    
            const chatMessagesComponents = chatMessages.map((chatMessege) => {
                return (
                    <ChatMessage 
                        messege={chatMessege.messege} 
                        sender={chatMessege.sender}
                        key={chatMessege.id}
                    />
                );
            });
            return (
                <div>
                   
                    {chatMessagesComponents}

                    </div>
            );
        }

       
            function App() {
                const [chatMessages, setChatMessages] =React.useState([
                {id: "1", messege: "Hello, chatbot.", sender: "user"},
                { id: "2", messege: "Hello, how can I help you?", sender: "robot" },
                { id: "3",messege: "Can you get me today's date?", sender: "user" },
                { id: "4",messege: "Today is January 24.", sender: "robot" },
            ]);

                return (
                    <>
                  <ChatInput
                      chatMessages={chatMessages}
                      setChatMessages={setChatMessages} 
                      />
                    <DisplayChat
                     chatMessages={chatMessages}
                      setChatMessages={setChatMessages}
                       /> 

                        
                       </>
                );
            };


            const container = document.querySelector('.js-container');
            ReactDOM.createRoot(container).render(<App />);
        
        </script>
    </body>
</html>